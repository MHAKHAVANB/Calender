<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªÙ‚ÙˆÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; }
    .nav { margin: 15px 0; text-align: center; }
    button { padding: 5px 10px; margin: 0 5px; }
    .event-box { margin: 10px 0; padding: 10px; background: #f0f0f0; }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    #bottomDatePicker { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 15px; }
    select, input { padding: 5px; margin: 0 5px; }
  </style>
</head>
<body>
  <h1>ØªÙ‚ÙˆÛŒÙ… Ù…Ù†Ø§Ø³Ø¨Øªâ€ŒÙ‡Ø§</h1>
  
  <!-- Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® ÙØ¹Ù„ÛŒ Ø¨Ù‡ Ø³Ù‡ ØªÙ‚ÙˆÛŒÙ… -->
  <div id="today"></div>
  
  <!-- Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø¯Ø± Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙˆÙ„ -->
  <div id="events"></div>
  
  <!-- Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ ØªØ§Ø±ÛŒØ® -->
  <div class="nav">
    <button onclick="changeMonth(-1)">Ù…Ø§Ù‡ Ù‚Ø¨Ù„</button>
    <button onclick="changeWeek(-1)">Ù‡ÙØªÙ‡ Ù‚Ø¨Ù„</button>
    <button onclick="changeDay(-1)">Ø±ÙˆØ² Ù‚Ø¨Ù„</button>
    <button onclick="changeDay(1)">Ø±ÙˆØ² Ø¨Ø¹Ø¯</button>
    <button onclick="changeWeek(1)">Ù‡ÙØªÙ‡ Ø¨Ø¹Ø¯</button>
    <button onclick="changeMonth(1)">Ù…Ø§Ù‡ Ø¨Ø¹Ø¯</button>
  </div>
  
  <!-- ÙØ±Ù… Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ø®Ø§Øµ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ -->
  <div id="bottomDatePicker">
    <h3>Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ø®Ø§Øµ:</h3>
    <select id="bottomCalendarType" onchange="updateBottomDateInputs()">
      <option value="shamsi">Ø´Ù…Ø³ÛŒ</option>
      <option value="miladi">Ù…ÛŒÙ„Ø§Ø¯ÛŒ</option>
      <option value="qamari">Ù‚Ù…Ø±ÛŒ</option>
    </select>
    <span id="bottomYearInput">
      <input type="number" id="bottomYear" placeholder="Ø³Ø§Ù„">
    </span>
    <select id="bottomMonth" onchange="updateBottomDays()"></select>
    <select id="bottomDay"></select>
    <button onclick="searchBottomDate()">Ø¨Ø±Ùˆ Ø¨Ù‡ ØªØ§Ø±ÛŒØ®</button>
    <div id="todayButtonDiv"></div>
  </div>

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® -->
  <script src="https://cdn.jsdelivr.net/npm/jalali-date@1.1.0/dist/jalali-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hijri-date@2.0.0/dist/hijri-date.min.js"></script>
  
  <script>
    // ØªØ¹Ø±ÛŒÙ Ø¢Ø±Ø§ÛŒÙ‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø´ÛŒØ¡ Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
    const eventFiles = [
      { calType: "shamsi", category: "Ù…Ù„ÛŒ", file: "shamsi_melli.json" },
      { calType: "qamari", category: "Ù…Ø°Ù‡Ø¨ÛŒ", file: "qamari_dini.json" },
      { calType: "miladi", category: "Ø¬Ù‡Ø§Ù†ÛŒ", file: "miladi_jahani.json" }
    ];
    // Ø¢Ø±Ø§ÛŒÙ‡ Ø¬Ù‡Øª Ø°Ø®ÛŒØ±Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù‡Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    const loadedEvents = [];
    
    // ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ Ø³Ø§ÛŒØª (Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ùˆ Ù†Ø§ÙˆØ¨Ø±ÛŒ)
    let currentDate = new Date();
    // ØªØ§Ø±ÛŒØ® ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ù…Ø±ÙˆØ² Ø¬Ù‡Øª Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø± Ø¨Ø®Ø´ Â«Ø¨Ø±Ùˆ Ø¨Ù‡ Ø§Ù…Ø±ÙˆØ²Â»
    const todayDate = new Date();
    
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§
    async function loadEvents() {
      for (const ev of eventFiles) {
        try {
          const response = await fetch(ev.file);
          const data = await response.json();
          // ÙØ±Ø¶ Ø¨Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ Ø³Ø§Ø®ØªØ§Ø± JSON Ø¨Ù‡ ØµÙˆØ±Øª { "category": { "MM-DD": [Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§] } } Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.
          loadedEvents.push({
            calType: ev.calType,
            category: ev.category,
            data: data[ev.category]
          });
        } catch (error) {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„:", ev.file, error);
          // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ ÛŒÚ© Ø´ÛŒØ¡ Ø®Ø§Ù„ÛŒ Ø¨Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
          loadedEvents.push({
            calType: ev.calType,
            category: ev.category,
            data: {}
          });
        }
      }
    }
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡
    function updateTodayDisplay() {
      const jDate = new JalaliDate(currentDate);
      const hDate = new HijriDate(currentDate);
      document.getElementById('today').innerHTML = `
        <div class="event-box">
          <h3>ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</h3>
          Ø´Ù…Ø³ÛŒ: ${jDate.getDate()} ${jDate.getMonthName()} ${jDate.getFullYear()}<br>
          Ù…ÛŒÙ„Ø§Ø¯ÛŒ: ${currentDate.toLocaleDateString('en-US')}<br>
          Ù‚Ù…Ø±ÛŒ: ${hDate.getDate()} ${hDate.getMonthName()} ${hDate.getFullYear()}
        </div>
      `;
    }
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
    function updateEventsTable() {
      let tableHTML = '<table><tr>';
      // Ø±Ø¯ÛŒÙ Ø¹Ù†ÙˆØ§Ù† Ø³ØªÙˆÙ†â€ŒÙ‡Ø§
      for (const ev of loadedEvents) {
        tableHTML += `<th>${ev.category} (${ev.calType})</th>`;
      }
      tableHTML += '</tr><tr>';
      // Ø±Ø¯ÛŒÙ Ù…Ø­ØªÙˆØ§: Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ØŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
      for (const ev of loadedEvents) {
        let dateObj;
        if(ev.calType === 'shamsi'){
          dateObj = new JalaliDate(currentDate);
        } else if(ev.calType === 'qamari'){
          dateObj = new HijriDate(currentDate);
        } else if(ev.calType === 'miladi'){
          dateObj = currentDate;
        }
        // ØªØ¨Ø¯ÛŒÙ„ Ù…Ø§Ù‡ Ùˆ Ø±ÙˆØ² Ø¨Ù‡ Ø±Ø´ØªÙ‡ Ø¯Ùˆ Ø±Ù‚Ù…ÛŒ
        let month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
        let day = dateObj.getDate().toString().padStart(2, '0');
        const key = `${month}-${day}`;
        const eventsList = (ev.data && ev.data[key]) ? ev.data[key] : ["Ù†Ø¯Ø§Ø±Ø¯"];
        let cellHTML = eventsList.map(item => `<div>ğŸ“…: ${item}</div>`).join('');
        tableHTML += `<td>${cellHTML}</td>`;
      }
      tableHTML += '</tr></table>';
      document.getElementById('events').innerHTML = tableHTML;
    }
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ú©Ù„ÛŒ ØµÙØ­Ù‡ (ØªØ§Ø±ÛŒØ® Ùˆ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ùˆ ÙØ±Ù… Ù¾Ø§ÛŒÛŒÙ†)
    function updateCalendar() {
      updateTodayDisplay();
      updateEventsTable();
      renderBottomDatePicker();
    }
    
    // ØªÙˆØ§Ø¨Ø¹ Ù†Ø§ÙˆØ¨Ø±ÛŒ ØªØ§Ø±ÛŒØ®
    function changeDay(offset) {
      currentDate.setDate(currentDate.getDate() + offset);
      updateCalendar();
    }
    function changeWeek(offset) {
      currentDate.setDate(currentDate.getDate() + (offset * 7));
      updateCalendar();
    }
    function changeMonth(offset) {
      currentDate.setMonth(currentDate.getMonth() + offset);
      updateCalendar();
    }
    
    // === Ø¨Ø®Ø´ ÙØ±Ù… Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ ===
    function renderBottomDatePicker() {
      // ØªÙ†Ø¸ÛŒÙ… Ø§ÙˆÙ„ÛŒÙ‡ ÙØ±Ù… Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒÛŒÙ†
      updateBottomDateInputs();
      // Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Â«Ø¨Ø±Ùˆ Ø¨Ù‡ Ø§Ù…Ø±ÙˆØ²Â» Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± ØªØ§Ø±ÛŒØ®
      const todayButtonDiv = document.getElementById('todayButtonDiv');
      if (currentDate.toDateString() !== todayDate.toDateString()) {
        todayButtonDiv.innerHTML = `<button onclick="goToToday()">Ø¨Ø±Ùˆ Ø¨Ù‡ Ø§Ù…Ø±ÙˆØ²</button>`;
      } else {
        todayButtonDiv.innerHTML = '';
      }
    }
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± ÙØ±Ù… Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ
    function updateBottomDateInputs() {
      const type = document.getElementById('bottomCalendarType').value;
      const months = {
        shamsi: ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'],
        qamari: ['Ù…Ø­Ø±Ù…', 'ØµÙØ±', 'Ø±Ø¨ÛŒØ¹ Ø§Ù„Ø§ÙˆÙ„', 'Ø±Ø¨ÛŒØ¹ Ø§Ù„Ø«Ø§Ù†ÛŒ', 'Ø¬Ù…Ø§Ø¯ÛŒ Ø§Ù„Ø§ÙˆÙ„', 'Ø¬Ù…Ø§Ø¯ÛŒ Ø§Ù„Ø«Ø§Ù†ÛŒ', 'Ø±Ø¬Ø¨', 'Ø´Ø¹Ø¨Ø§Ù†', 'Ø±Ù…Ø¶Ø§Ù†', 'Ø´ÙˆØ§Ù„', 'Ø°ÛŒÙ‚Ø¹Ø¯Ù‡', 'Ø°ÛŒØ­Ø¬Ù‡'],
        miladi: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
      };
      const bottomYearInput = document.getElementById('bottomYear');
      const bottomMonthSelect = document.getElementById('bottomMonth');
      bottomMonthSelect.innerHTML = '';
      
      if (type === 'shamsi') {
        const jDate = new JalaliDate(currentDate);
        bottomYearInput.value = jDate.getFullYear();
        bottomMonthSelect.innerHTML = months.shamsi.map((m, i) => `<option value="${i + 1}" ${i === jDate.getMonth() ? 'selected' : ''}>${m}</option>`).join('');
      } else if (type === 'qamari') {
        const hDate = new HijriDate(currentDate);
        bottomYearInput.value = hDate.getFullYear();
        bottomMonthSelect.innerHTML = months.qamari.map((m, i) => `<option value="${i + 1}" ${i === hDate.getMonth() ? 'selected' : ''}>${m}</option>`).join('');
      } else { // miladi
        bottomYearInput.value = currentDate.getFullYear();
        bottomMonthSelect.innerHTML = months.miladi.map((m, i) => `<option value="${i + 1}" ${i === currentDate.getMonth() ? 'selected' : ''}>${m}</option>`).join('');
      }
      updateBottomDays();
    }
    
    function updateBottomDays() {
      const type = document.getElementById('bottomCalendarType').value;
      const year = parseInt(document.getElementById('bottomYear').value) || 1;
      const month = parseInt(document.getElementById('bottomMonth').value);
      const bottomDaySelect = document.getElementById('bottomDay');
      
      let daysInMonth;
      try {
        if (type === 'shamsi') {
          const jDate = new JalaliDate(year, month - 1, 1);
          daysInMonth = jDate.daysInMonth();
        } else if (type === 'qamari') {
          const hDate = new HijriDate(year, month - 1, 1);
          daysInMonth = hDate.daysInMonth();
        } else {
          const miladi = new Date(year, month, 0);
          daysInMonth = miladi.getDate();
        }
      } catch (error) {
        daysInMonth = 30;
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ²Ù‡Ø§:", error);
      }
      
      bottomDaySelect.innerHTML = '';
      for (let i = 1; i <= daysInMonth; i++) {
        bottomDaySelect.innerHTML += `<option value="${i}">${i}</option>`;
      }
      
      // ØªÙ†Ø¸ÛŒÙ… Ø±ÙˆØ² Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø·Ø§Ø¨Ù‚ ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ
      let currentDay;
      if (type === 'shamsi') {
        const jDate = new JalaliDate(currentDate);
        currentDay = jDate.getDate();
      } else if (type === 'qamari') {
        const hDate = new HijriDate(currentDate);
        currentDay = hDate.getDate();
      } else {
        currentDay = currentDate.getDate();
      }
      bottomDaySelect.value = currentDay;
    }
    
    // Ø¬Ø³ØªØ¬ÙˆÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø² ÙØ±Ù… Ù¾Ø§ÛŒÛŒÙ†
    function searchBottomDate() {
      const type = document.getElementById('bottomCalendarType').value;
      const year = parseInt(document.getElementById('bottomYear').value);
      const month = parseInt(document.getElementById('bottomMonth').value);
      const day = parseInt(document.getElementById('bottomDay').value);
      
      if (type === 'shamsi') {
        const jDate = new JalaliDate(year, month - 1, day);
        currentDate = jDate.toGregorian();
      } else if (type === 'qamari') {
        const hDate = new HijriDate(year, month - 1, day);
        currentDate = hDate.toGregorian();
      } else {
        currentDate = new Date(year, month - 1, day);
      }
      updateCalendar();
    }
    
    // Ø¯Ú©Ù…Ù‡ Â«Ø¨Ø±Ùˆ Ø¨Ù‡ Ø§Ù…Ø±ÙˆØ²Â» Ø¯Ø± ÙØ±Ù… Ù¾Ø§ÛŒÛŒÙ†
    function goToToday() {
      currentDate = new Date();
      updateCalendar();
    }
    
    // Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡: Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ø³Ù¾Ø³ ØªÙ‚ÙˆÛŒÙ… Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    window.onload = async () => {
      await loadEvents();
      updateCalendar();
    };
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªÙ‚ÙˆÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; padding: 20px; }
    .nav { margin: 10px 0; }
    button { padding: 5px 10px; margin: 0 5px; }
    .date-picker { margin: 20px 0; padding: 10px; border: 1px solid #ddd; }
    select, input { padding: 5px; margin: 0 5px; }
    .event { margin: 10px 0; padding: 10px; background: #f0f0f0; }
    .category-title { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>ØªÙ‚ÙˆÛŒÙ… Ù…Ù†Ø§Ø³Ø¨Øªâ€ŒÙ‡Ø§</h1>
  
  <!-- Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ -->
  <div class="nav">
    <button onclick="changeDate(-7)">Ù‡ÙØªÙ‡ Ù‚Ø¨Ù„</button>
    <button onclick="changeDate(-1)">Ø±ÙˆØ² Ù‚Ø¨Ù„</button>
    <button onclick="changeDate(1)">Ø±ÙˆØ² Ø¨Ø¹Ø¯</button>
    <button onclick="changeDate(7)">Ù‡ÙØªÙ‡ Ø¨Ø¹Ø¯</button>
  </div>

  <!-- ÙØ±Ù… Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø³ØªÛŒ ØªØ§Ø±ÛŒØ® -->
  <div class="date-picker">
    <h3>Ø¬Ø³ØªØ¬ÙˆÛŒ ØªØ§Ø±ÛŒØ®:</h3>
    <select id="calendarType" onchange="updateDateInputs()">
      <option value="shamsi">Ø´Ù…Ø³ÛŒ</option>
      <option value="miladi">Ù…ÛŒÙ„Ø§Ø¯ÛŒ</option>
      <option value="qamari">Ù‚Ù…Ø±ÛŒ</option>
    </select>
    
    <span id="yearInput">
      <input type="number" id="year" placeholder="Ø³Ø§Ù„">
    </span>
    
    <select id="month" onchange="updateDays()"></select>
    <select id="day"></select>
    
    <button onclick="searchDate()">Ø¬Ø³ØªØ¬Ùˆ</button>
  </div>

  <!-- Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ®Ø§Ø¨ÛŒ -->
  <div id="today"></div>
  <!-- Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ -->
  <div id="events"></div>

  <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® -->
  <script src="https://cdn.jsdelivr.net/npm/jalali-date@1.1.0/dist/jalali-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hijri-date@2.0.0/dist/hijri-date.min.js"></script>

  <script>
    // Ø¢Ø±Ø§ÛŒÙ‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ø› Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø¢Ø±Ø§ÛŒÙ‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.
    const eventFiles = [
      "shamsi_melli.json",
      "qamari_dini.json",
      "miladi_jahani.json"
      // Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡ Ø¬Ø¯ÛŒØ¯ Ù…Ø«Ù„Ø§Ù‹ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ:
      // "shamsi_danesh.json"
    ];

    // Ø´ÛŒØ¡ eventsDB Ø¬Ù‡Øª Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ‚ÙˆÛŒÙ…
    const eventsDB = {};

    // ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ (Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ) Ø¨Ù‡ ØµÙˆØ±Øª Ù…ÛŒÙ„Ø§Ø¯ÛŒ
    let currentDate = new Date();

    // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
    async function loadEvents() {
      for (const fileName of eventFiles) {
        try {
          const response = await fetch(fileName);
          const data = await response.json();
          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†ÙˆØ¹ ØªÙ‚ÙˆÛŒÙ… Ùˆ Ø¯Ø³ØªÙ‡ Ø§Ø² Ù†Ø§Ù… ÙØ§ÛŒÙ„:
          // Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø¨Ù‡ ØµÙˆØ±Øª "Ù†ÙˆØ¹_Ø¯Ø³ØªÙ‡.json" Ø§Ø³Øª.
          const parts = fileName.split('_');
          const calType = parts[0]; // Ù…Ø«Ù„Ø§Ù‹ "shamsi"
          // Ù‚Ø³Ù…Øª Ø¯ÙˆÙ… Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø´Ø§Ù…Ù„ Ù¾Ø³ÙˆÙ†Ø¯ .json Ø¨Ø§Ø´Ø¯Ø› Ø¬Ø¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…:
          const categoryWithExt = parts[1];
          const category = categoryWithExt.split('.')[0]; // Ù…Ø«Ù„Ø§Ù‹ "melli"

          // Ø§Ú¯Ø± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªÙ‚ÙˆÛŒÙ… Ù‚Ø¨Ù„Ø§Ù‹ Ú©Ù„ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
          if (!eventsDB[calType]) {
            eventsDB[calType] = {};
          }
          // Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØªØ­Øª Ú©Ù„ÛŒØ¯ Ø¯Ø³ØªÙ‡
          eventsDB[calType][category] = data[category];
        } catch (error) {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„:", fileName, error);
        }
      }
    }

    // Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ Ø§Ø¨ØªØ¯Ø§ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø±Ø¯Ù‡ Ùˆ Ø³Ù¾Ø³ ØªÙ‚ÙˆÛŒÙ… Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯
    window.onload = async () => {
      await loadEvents();
      updateDateInputs();
      updateCalendar();
    };

    // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ ØªÙ‚ÙˆÛŒÙ…: Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¨Ù‡ Ø³Ù‡ ØªÙ‚ÙˆÛŒÙ…
    function updateCalendar() {
      const jalali = new JalaliDate(currentDate);
      const hijri = new HijriDate(currentDate);
      document.getElementById('today').innerHTML = `
        <div class="event">
          <h3>ØªØ§Ø±ÛŒØ® Ø§Ù†ØªØ®Ø§Ø¨ÛŒ:</h3>
          Ø´Ù…Ø³ÛŒ: ${jalali.getDate()} ${jalali.getMonthName()} ${jalali.getFullYear()}<br>
          Ù…ÛŒÙ„Ø§Ø¯ÛŒ: ${currentDate.toLocaleDateString('en-US')}<br>
          Ù‚Ù…Ø±ÛŒ: ${hijri.getDate()} ${hijri.getMonthName()} ${hijri.getFullYear()}
        </div>
      `;

      // Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
      const eventsDiv = document.getElementById('events');
      eventsDiv.innerHTML = '';

      // Ø¨Ø±Ø§ÛŒ Ù‡Ø± ØªÙ‚ÙˆÛŒÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø¯Ø± eventsDBØŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ØªØ§Ø±ÛŒØ® Ø¬Ø§Ø±ÛŒ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
      for (const calType in eventsDB) {
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÛŒØ¡ ØªØ§Ø±ÛŒØ® Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ØªÙ‚ÙˆÛŒÙ…
        let dateObj;
        if (calType === "shamsi") {
          dateObj = new JalaliDate(currentDate);
        } else if (calType === "qamari") {
          dateObj = new HijriDate(currentDate);
        } else if (calType === "miladi") {
          dateObj = currentDate;
        } else {
          continue;
        }
        displayEventsForCalendar(dateObj, eventsDB[calType], calType);
      }
    }

    // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ ÛŒÚ© ØªÙ‚ÙˆÛŒÙ… Ø®Ø§Øµ
    function displayEventsForCalendar(dateObj, eventsData, calendarType) {
      let month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
      let day = dateObj.getDate().toString().padStart(2, '0');
      const key = `${month}-${day}`;

      for (const category in eventsData) {
        if (eventsData[category][key]) {
          document.getElementById('events').innerHTML += `
            <div class="category-title">${category} (${calendarType})</div>
          `;
          eventsData[category][key].forEach(event => {
            document.getElementById('events').innerHTML += `
              <div class="event">ğŸ“…: ${event}</div>
            `;
          });
        }
      }
    }

    // ØªØºÛŒÛŒØ± ØªØ§Ø±ÛŒØ® Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ
    function changeDate(offset) {
      currentDate.setDate(currentDate.getDate() + offset);
      updateCalendar();
    }

    // Ø¨Ø®Ø´ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø³ØªÛŒ ØªØ§Ø±ÛŒØ®
    function updateDateInputs() {
      const type = document.getElementById('calendarType').value;
      const months = {
        shamsi: ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'],
        qamari: ['Ù…Ø­Ø±Ù…', 'ØµÙØ±', 'Ø±Ø¨ÛŒØ¹ Ø§Ù„Ø§ÙˆÙ„', 'Ø±Ø¨ÛŒØ¹ Ø§Ù„Ø«Ø§Ù†ÛŒ', 'Ø¬Ù…Ø§Ø¯ÛŒ Ø§Ù„Ø§ÙˆÙ„', 'Ø¬Ù…Ø§Ø¯ÛŒ Ø§Ù„Ø«Ø§Ù†ÛŒ', 'Ø±Ø¬Ø¨', 'Ø´Ø¹Ø¨Ø§Ù†', 'Ø±Ù…Ø¶Ø§Ù†', 'Ø´ÙˆØ§Ù„', 'Ø°ÛŒÙ‚Ø¹Ø¯Ù‡', 'Ø°ÛŒØ­Ø¬Ù‡'],
        miladi: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
      };

      const monthSelect = document.getElementById('month');
      monthSelect.innerHTML = '';
      months[type].forEach((month, index) => {
        monthSelect.innerHTML += `<option value="${index + 1}">${month}</option>`;
      });
      updateDays();
    }

    // Ø¨Ù‡â€ŒØ±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ù…Ø§Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ù„ Ùˆ ØªÙ‚ÙˆÛŒÙ…
    function updateDays() {
      const type = document.getElementById('calendarType').value;
      const year = parseInt(document.getElementById('year').value) || 1;
      const month = parseInt(document.getElementById('month').value);
      const daySelect = document.getElementById('day');

      let daysInMonth;
      try {
        if (type === 'shamsi') {
          const jalali = new JalaliDate(year, month - 1, 1);
          daysInMonth = jalali.daysInMonth();
        } else if (type === 'qamari') {
          const hijri = new HijriDate(year, month - 1, 1);
          daysInMonth = hijri.daysInMonth();
        } else {
          const miladi = new Date(year, month, 0);
          daysInMonth = miladi.getDate();
        }
      } catch (error) {
        daysInMonth = 30;
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ²Ù‡Ø§:", error);
      }

      daySelect.innerHTML = '';
      for (let i = 1; i <= daysInMonth; i++) {
        daySelect.innerHTML += `<option value="${i}">${i}</option>`;
      }
    }

    // Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¯Ø³ØªÛŒ ØªØ§Ø±ÛŒØ®
    function searchDate() {
      const type = document.getElementById('calendarType').value;
      const year = parseInt(document.getElementById('year').value);
      const month = parseInt(document.getElementById('month').value);
      const day = parseInt(document.getElementById('day').value);

      if (type === 'shamsi') {
        const jalaliDate = new JalaliDate(year, month - 1, day);
        currentDate = jalaliDate.toGregorian();
      } else if (type === 'qamari') {
        const hijriDate = new HijriDate(year, month - 1, day);
        currentDate = hijriDate.toGregorian();
      } else {
        currentDate = new Date(year, month - 1, day);
      }
      updateCalendar();
    }
  </script>
</body>
</html>
